require(["config"],function(){require(["libs/pjs","libs/chart","libs/utily","services/dateService","libs/dateChange","zepto","libs/sidebar"],function(a,b,c,d,e,f){function g(b){b&&sessionStorage.setItem("cur_time",b);var c,d=document.querySelector(".date_select_item").getAttribute("unit")||parseInt(sessionStorage.getItem("cur_unit"),10),e=sessionStorage.getItem("cur_time"),f=o.staticSummary;c=void 0!=b?b||n:e||n,d||(d=a.getPathArgument("unit")),f?(document.getElementById("js_excepte_needMoney").innerText="￥"+k(f.summary.needTotal,2),document.getElementById("js_excpte_reciveMoney").innerText="￥"+k(f.summary.recieveTotal,2)):(document.querySelector("body").style.backgroundColor="#fff",document.getElementById("js_excepte_needMoney").innerText=0,document.getElementById("js_excpte_reciveMoney").innerText=0)}function h(a){a&&sessionStorage.setItem("cur_time",a);var c=document.getElementById("abnormal-data-bar").getContext("2d"),d={labels:[],datasets:[{fillColor:"#35C8DD",data:[]}]},e=document.querySelector(".date_select_item").getAttribute("unit")||parseInt(sessionStorage.getItem("cur_unit"),10);!function(){var a=(document.getElementById("j-abn-list"),document.querySelector(".data-report"),o.abnormalSummary),e=document.querySelector(".abnormal_tips");if(a){a.length?e.style.display="none":a.length||(e.style.display="inline-block",f(".menu-item .list-num").text(0)),f(".menu-item .list-num").text(0);for(var g=0;g<a.length;g++)f(".menu-item[type="+a[g].exceptionType+"] .list-num").text(a[g].exceptionNum),d.labels.push(a[g].exceptionType),d.datasets[0].data.push(a[g].exceptionMoney.toFixed(2))}var h=170/a.length;j&&j.destroy(),j=new b(c).Bar(d,{barValueSpacing:h,scaleShowGridLines:!0,scaleFontFamily:"'微软雅黑','Helvetica'",scaleFontSize:24,scaleLabel:"￥<%=value%>"})}(),function(a){for(var b,c,d=document.querySelector("#j-abn-list"),f=document.querySelectorAll("li.menu-item"),g=0;g<f.length;g++)d.addEventListener("touchstart",function(a){b=a.touches[0].pageY}),d.addEventListener("touchmove",function(a){c=a.touches[0].pageY}),f[g].addEventListener("touchend",function(a){if(Math.abs(c-b)>5&&0!==c)return void(c=0);a.preventDefault();var d=this.getAttribute("type");window.location="abnormalorderdetail.html?hotelId="+m+"&startTime="+n+"&type="+i(d)+"&unit="+e},!1)}()}function i(a){switch(a){case"打折":return"discount";case"挂账":return"oncredit";case"赠送":return"gift";case"抹零":return"wipe";case"免单":return"free";case"反结":return"reverse";case"退菜":return"back"}}var j,k=c.toFixed,l=new Date,m=a.getPathArgument("hotelId"),n=Date.parse(l.getFullYear()+"/"+(l.getMonth()+1)+"/"+l.getDate()+" 23:59:00"),o={staticSummary:{summary:{needTotal:376,needTotalText:"376.00",recieveTotal:364,recieveTotalText:"364.00",oncreditTotal:0,oncreditTotalText:null,freeTotal:0,freeTotalText:null,backDishTotal:0,backDishTotalText:null,preferentialTotal:0,preferentialTotalText:null,serviceFee:0,serviceFeeText:null,ordernumTotal:0,customernumTotal:0,tableReuseRate:0,tableReuseRatePercent:null,avgPerPerson:0,avgPerTable:0,maxDaily:0,maxDailyText:null,avgDaily:0,avgDailyText:null},payment:null,discount:null,money:null},abnormalSummary:[{exceptionType:"免单",exceptionNum:1,exceptionMoney:12,exceptionMoneyText:"12.00"}]};d.loadDateValue();document.querySelector(".main-menuwrap");g(),h();var p=document.querySelector(".top-nav").querySelector(".go-directory");p.href=p.href+"?hotelId="+m;var q=document.querySelector(".go-back");q.addEventListener("touchstart",function(){window.location.href="index.html?hotelId="+m},!1);var r=document.querySelector(".px_date_right"),s=document.querySelector(".px_date_left");r.addEventListener("click",function(){var a=e.date(1);sessionStorage.setItem("cur_time",a),h(a),g(a)},!1),s.addEventListener("click",function(){var a=e.date(-1);sessionStorage.setItem("cur_time",a),h(a),g(a)},!1),d.subscribeDate(h),d.subscribeDate(g),f(document).on("date",function(a,b,c){sessionStorage.setItem("cur_unit",c),sessionStorage.setItem("cur_time",b),h(b),g(b)})})});