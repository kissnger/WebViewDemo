require(["config"],function(){require(["libs/pjs","libs/chart","libs/utily","services/dateService","libs/dateChange","zepto","libs/artTemplate","libs/loadMore","libs/sidebar"],function(a,b,c,d,e,f,g,h){function i(a){var b,c="";return!a&&m&&m.length?(c=g("starTop3Dish",{starData:m}),void f(".star-topdishes-ul").html(c)):(b=C.star,b&&b.length&&(m=b.slice(1),c=g("starTop3Dish",{starData:m})),void f(".star-topdishes-ul").html(c))}function j(a){if(n&&n.destroy(),a){var c=[],d=0;if(t=0,a.length){for(var e=1;e<a.length;e+=1)if(d=a[e].charge/a[0].charge,t+=d,c.push({value:100*d,color:s[e-1],label:a[e].name}),e>=5){c.push({value:100*(1-t),color:s[e],label:"其他"});break}f(".canvas-img").hide(),n=new b(r).Doughnut(c,{animationSteps:1,segmentShowStroke:!1,percentageInnerCutout:65,tooltipFontFamily:"'微软雅黑', 'Helvetica', 'Helvetica Neue'",tooltipFontSize:20,tooltipTemplate:"<%if (label){%><%=label%>: <%}%><%= value.toFixed(2) %>%",legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li class="lengend-item" ><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%> : <%=segments[i].value.toFixed(2)%>% <%}%></li><%}%></ul>',onAnimationComplete:function(){1===c.length&&f(".canvas-img").show()}}),f(".hint-title").html("总销售额"),f(".hint-count").html("￥"+o(a[0].charge,2)),document.getElementById("js-legend").innerHTML=n.generateLegend()}}}function k(a,b){var c,d,e,h;if(d=a&&a.type&&"category"!=a.type?a.type:"category",c=p[d].data,p[d].isLastPage||(document.querySelector(".loading").style.display="block"),a&&w===a.startTime&&A==z&&c&&c.length&&!b)"category"==d||"charge"==d?(e=g("dishTypeTitle",{}),e+=g("disheTypeList",{totalMoney:p[d].data[0].charge,dishData:p[d].data})):(e=g("dishListTitle",{}),e+=g("disheList",{totalMoney:p[d].data[0].charge,dishData:p[d].data})),"category"==d||"charge"==d?(f(".chart-wrap").show(),j(p[d].data)):f(".chart-wrap").hide(),f(".dishes-detail-ul").html(e),"charge"===d&&f(".dishes-title-item").eq(0).text("菜名"),f(".star-dishes-top3").show(),document.querySelector(".dishes-statis-detail").style.display="block",p[d].isLastPage?document.querySelector(".loading").style.display="none":document.querySelector(".loading").style.display="block",f(".no-datas").hide();else{if(a&&(w!==a.startTime||A!==a.unit)){a&&(w=a.startTime,A=a.unit);for(var i in p)p.hasOwnProperty(i)&&(p[i].curNum=0,p[i].data=[],p[i].isLastPage=!1)}if(h=p[d].isLastPage)return;var k,l,m=C[d];m&&m.length>0?(f("#js_loadMore").removeClass("pullUp-relative"),f(".star-dishes-top3").show(),document.querySelector(".dishes-statis-detail").style.display="block",f(".no-datas").hide(),"category"==d||"charge"==d?(l="dishTypeTitle",k="disheTypeList"):(l="dishListTitle",k="disheList"),0===p[d].data.length&&(f(".dishes-detail-ul").html(""),e=g(l,{}),f(".dishes-detail-ul").append(e)),p[d].data=p[d].data.concat(m),"category"==d||"charge"==d?(f(".chart-wrap").show(),0===p[d].curNum&&j(p[d].data)):f(".chart-wrap").hide(),p[d].curNum+=m.length,m.length<q&&(p[d].isLastPage=!0,document.querySelector(".loading").style.display="none"),e=g(k,{totalMoney:p[d].data[0].charge,dishData:m}),f(".dishes-detail-ul").append(e),"charge"===d&&f(".dishes-title-item").eq(0).text("菜名")):(0===p[d].data.length&&(f(".star-dishes-top3").hide(),document.querySelector(".dishes-statis-detail").style.display="none",f(".no-datas").show(),f(".dishes-detail-ul").html("")),document.querySelector(".loading").style.display="none",p[d].isLastPage=!0)}}function l(a){a&&m.length>1||m.length<=1&&alert("已经为最后一个明星菜品不能取消了!"),f(".px-confirm").hide(),f(".mask").hide()}var m,n,o=c.toFixed,p={category:{curNum:0,isLastPage:!1,data:[]},charge:{curNum:0,isLastPage:!1,data:[]},numdesc:{curNum:0,isLastPage:!1,data:[]},numasc:{curNum:0,isLastPage:!1,data:[]}},q=50,r=document.getElementById("js_dishes_report").getContext("2d"),s=["#35c8de","#afcf36","#fe9e6d","#e5c71f","#d9faf4","#919191"],t=0,u=new Date,v=a.getPathArgument("hotelId"),w=parseInt(sessionStorage.getItem("cur_time"),10)||Date.parse(u.getFullYear()+"/"+(u.getMonth()+1)+"/"+u.getDate()+" 23:59:00"),x=document.querySelector(".px_date_right"),y=document.querySelector(".px_date_left"),z=parseInt(sessionStorage.getItem("cur_unit"),10)||1,A=1,B=localStorage.getItem("cancelTip"),C={star:[{name:"total",id:"",price:0,priceText:"0.00",charge:315,chargeText:"315.00",count:13,index:0},{name:"水晶猪冻蹄",id:"50041",price:26,priceText:"26.00",charge:78,chargeText:"78.00",count:3,index:1},{name:"蓝啤桶",id:"60031",price:96,priceText:"96.00",charge:96,chargeText:"96.00",count:1,index:2},{name:"王老吉",id:"60002",price:8,priceText:"8.00",charge:24,chargeText:"24.00",count:3,index:3},{name:"绿牛二",id:"60008",price:12,priceText:"12.00",charge:24,chargeText:"24.00",count:2,index:4},{name:"红星蓝瓶",id:"60009",price:38,priceText:"38.00",charge:38,chargeText:"38.00",count:1,index:5},{name:"黄鹤楼",id:"60022",price:25,priceText:"25.00",charge:25,chargeText:"25.00",count:1,index:6},{name:"白牛二",id:"60007",price:18,priceText:"18.00",charge:18,chargeText:"18.00",count:1,index:7},{name:"白红塔山",id:"60024",price:12,priceText:"12.00",charge:12,chargeText:"12.00",count:1,index:8}],category:[{name:"total",id:"",price:0,priceText:"0.00",charge:315,chargeText:"315.00",count:13,index:0},{name:"酒水类",id:"004",price:0,priceText:"0.00",charge:237,chargeText:"237.00",count:10,index:1},{name:"凉菜",id:"1643",price:0,priceText:"0.00",charge:78,chargeText:"78.00",count:3,index:2}],charge:[{name:"total",id:"",price:0,priceText:"0.00",charge:315,chargeText:"315.00",count:13,index:0},{name:"蓝啤桶",id:"60031",price:96,priceText:"96.00",charge:96,chargeText:"96.00",count:1,index:1},{name:"水晶猪冻蹄",id:"50041",price:26,priceText:"26.00",charge:78,chargeText:"78.00",count:3,index:2},{name:"红星蓝瓶",id:"60009",price:38,priceText:"38.00",charge:38,chargeText:"38.00",count:1,index:3},{name:"黄鹤楼",id:"60022",price:25,priceText:"25.00",charge:25,chargeText:"25.00",count:1,index:4},{name:"王老吉",id:"60002",price:8,priceText:"8.00",charge:24,chargeText:"24.00",count:3,index:5},{name:"绿牛二",id:"60008",price:12,priceText:"12.00",charge:24,chargeText:"24.00",count:2,index:6},{name:"白牛二",id:"60007",price:18,priceText:"18.00",charge:18,chargeText:"18.00",count:1,index:7},{name:"白红塔山",id:"60024",price:12,priceText:"12.00",charge:12,chargeText:"12.00",count:1,index:8}],numdesc:[{name:"total",id:"",price:0,priceText:"0.00",charge:315,chargeText:"315.00",count:13,index:0},{name:"水晶猪冻蹄",id:"50041",price:26,priceText:"26.00",charge:78,chargeText:"78.00",count:3,index:1},{name:"王老吉",id:"60002",price:8,priceText:"8.00",charge:24,chargeText:"24.00",count:3,index:2},{name:"绿牛二",id:"60008",price:12,priceText:"12.00",charge:24,chargeText:"24.00",count:2,index:3},{name:"白牛二",id:"60007",price:18,priceText:"18.00",charge:18,chargeText:"18.00",count:1,index:4},{name:"红星蓝瓶",id:"60009",price:38,priceText:"38.00",charge:38,chargeText:"38.00",count:1,index:5},{name:"黄鹤楼",id:"60022",price:25,priceText:"25.00",charge:25,chargeText:"25.00",count:1,index:6},{name:"白红塔山",id:"60024",price:12,priceText:"12.00",charge:12,chargeText:"12.00",count:1,index:7},{name:"蓝啤桶",id:"60031",price:96,priceText:"96.00",charge:96,chargeText:"96.00",count:1,index:8},{name:"一口鲜豆腐",id:"11160",price:32,priceText:"32.00",charge:0,chargeText:"0.00",count:0,index:9},{name:"一品扣肉卧蛋",id:"11161",price:42,priceText:"42.00",charge:0,chargeText:"0.00",count:0,index:10},{name:"一品香酥肉",id:"11184",price:36,priceText:"36.00",charge:0,chargeText:"0.00",count:0,index:11},{name:"一品鱿鱼",id:"11156",price:32,priceText:"32.00",charge:0,chargeText:"0.00",count:0,index:12},{name:"一品鲜羊锅",id:"11186",price:46,priceText:"46.00",charge:0,chargeText:"0.00",count:0,index:13},{name:"一绝小炒",id:"11158",price:26,priceText:"26.00",charge:0,chargeText:"0.00",count:0,index:14},{name:"一绝梧桐花",id:"11157",price:58,priceText:"58.00",charge:0,chargeText:"0.00",count:0,index:15},{name:"一绝火爆菜",id:"12346",price:26,priceText:"26.00",charge:0,chargeText:"0.00",count:0,index:16},{name:"一绝豆腐丝",id:"22203",price:18,priceText:"18.00",charge:0,chargeText:"0.00",count:0,index:17},{name:"一锅香",id:"11164",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:18},{name:"丁香米肉",id:"00042",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:19},{name:"丁香鱼拌苦菊",id:"11136",price:18,priceText:"18.00",charge:0,chargeText:"0.00",count:0,index:20},{name:"三丝爆豆",id:"00039",price:18,priceText:"18.00",charge:0,chargeText:"0.00",count:0,index:21},{name:"三叠烫大虾",id:"44409",price:58,priceText:"58.00",charge:0,chargeText:"0.00",count:0,index:22},{name:"上品黑土地",id:"60012",price:68,priceText:"68.00",charge:0,chargeText:"0.00",count:0,index:23},{name:"上汤娃娃菜",id:"44414",price:28,priceText:"28.00",charge:0,chargeText:"0.00",count:0,index:24},{name:"下饭小菜",id:"11187",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:25},{name:"中劲酒",id:"60061",price:30,priceText:"30.00",charge:0,chargeText:"0.00",count:0,index:26},{name:"中华",id:"00052",price:88,priceText:"88.00",charge:0,chargeText:"0.00",count:0,index:27},{name:"丰收炖菜",id:"11167",price:48,priceText:"48.00",charge:0,chargeText:"0.00",count:0,index:28},{name:"乡村木耳爆腰片",id:"11185",price:34,priceText:"34.00",charge:0,chargeText:"0.00",count:0,index:29},{name:"乡村野菜丸子",id:"40018",price:26,priceText:"26.00",charge:0,chargeText:"0.00",count:0,index:30},{name:"二锅头加",id:"50126",price:58,priceText:"58.00",charge:0,chargeText:"0.00",count:0,index:31},{name:"五彩泰国明虾球",id:"11183",price:28,priceText:"28.00",charge:0,chargeText:"0.00",count:0,index:32},{name:"京酱肉丝",id:"44417",price:32,priceText:"32.00",charge:0,chargeText:"0.00",count:0,index:33},{name:"什锦小炒美人骨",id:"11179",price:42,priceText:"42.00",charge:0,chargeText:"0.00",count:0,index:34},{name:"什锦干锅蘑",id:"11189",price:32,priceText:"32.00",charge:0,chargeText:"0.00",count:0,index:35},{name:"什锦牛丸",id:"11159",price:48,priceText:"48.00",charge:0,chargeText:"0.00",count:0,index:36},{name:"兰花小炒",id:"44428",price:28,priceText:"28.00",charge:0,chargeText:"0.00",count:0,index:37},{name:"兰花牛肉",id:"11138",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:38},{name:"养生骨髓羹",id:"40042",price:36,priceText:"36.00",charge:0,chargeText:"0.00",count:0,index:39},{name:"农家一锅出",id:"40008",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:40},{name:"农家大炖",id:"44420",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:41},{name:"农家杀猪菜",id:"40050",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:42},{name:"农家韭菜土鸡蛋",id:"11180",price:26,priceText:"26.00",charge:0,chargeText:"0.00",count:0,index:43},{name:"冰樽纯生",id:"20021",price:12,priceText:"12.00",charge:0,chargeText:"0.00",count:0,index:44},{name:"冰纯",id:"20020",price:8,priceText:"8.00",charge:0,chargeText:"0.00",count:0,index:45},{name:"刺身拼盘",id:"50030",price:228,priceText:"228.00",charge:0,chargeText:"0.00",count:0,index:46},{name:"加工费1",id:"11143",price:10,priceText:"10.00",charge:0,chargeText:"0.00",count:0,index:47},{name:"加工费2",id:"11142",price:15,priceText:"15.00",charge:0,chargeText:"0.00",count:0,index:48},{name:"加工费3",id:"11141",price:20,priceText:"20.00",charge:0,chargeText:"0.00",count:0,index:49}],numasc:[{name:"total",id:"",price:0,priceText:"0.00",charge:315,chargeText:"315.00",count:13,index:0},{name:"一口鲜豆腐",id:"11160",price:32,priceText:"32.00",charge:0,chargeText:"0.00",count:0,index:1},{name:"一品扣肉卧蛋",id:"11161",price:42,priceText:"42.00",charge:0,chargeText:"0.00",count:0,index:2},{name:"一品香酥肉",id:"11184",price:36,priceText:"36.00",charge:0,chargeText:"0.00",count:0,index:3},{name:"一品鱿鱼",id:"11156",price:32,priceText:"32.00",charge:0,chargeText:"0.00",count:0,index:4},{name:"一品鲜羊锅",id:"11186",price:46,priceText:"46.00",charge:0,chargeText:"0.00",count:0,index:5},{name:"一绝小炒",id:"11158",price:26,priceText:"26.00",charge:0,chargeText:"0.00",count:0,index:6},{name:"一绝梧桐花",id:"11157",price:58,priceText:"58.00",charge:0,chargeText:"0.00",count:0,index:7},{name:"一绝火爆菜",id:"12346",price:26,priceText:"26.00",charge:0,chargeText:"0.00",count:0,index:8},{name:"一绝豆腐丝",id:"22203",price:18,priceText:"18.00",charge:0,chargeText:"0.00",count:0,index:9},{name:"一锅香",id:"11164",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:10},{name:"丁香米肉",id:"00042",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:11},{name:"丁香鱼拌苦菊",id:"11136",price:18,priceText:"18.00",charge:0,chargeText:"0.00",count:0,index:12},{name:"三丝爆豆",id:"00039",price:18,priceText:"18.00",charge:0,chargeText:"0.00",count:0,index:13},{name:"三叠烫大虾",id:"44409",price:58,priceText:"58.00",charge:0,chargeText:"0.00",count:0,index:14},{name:"上品黑土地",id:"60012",price:68,priceText:"68.00",charge:0,chargeText:"0.00",count:0,index:15},{name:"上汤娃娃菜",id:"44414",price:28,priceText:"28.00",charge:0,chargeText:"0.00",count:0,index:16},{name:"下饭小菜",id:"11187",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:17},{name:"中劲酒",id:"60061",price:30,priceText:"30.00",charge:0,chargeText:"0.00",count:0,index:18},{name:"中华",id:"00052",price:88,priceText:"88.00",charge:0,chargeText:"0.00",count:0,index:19},{name:"丰收炖菜",id:"11167",price:48,priceText:"48.00",charge:0,chargeText:"0.00",count:0,index:20},{name:"乡村木耳爆腰片",id:"11185",price:34,priceText:"34.00",charge:0,chargeText:"0.00",count:0,index:21},{name:"乡村野菜丸子",id:"40018",price:26,priceText:"26.00",charge:0,chargeText:"0.00",count:0,index:22},{name:"二锅头加",id:"50126",price:58,priceText:"58.00",charge:0,chargeText:"0.00",count:0,index:23},{name:"五彩泰国明虾球",id:"11183",price:28,priceText:"28.00",charge:0,chargeText:"0.00",count:0,index:24},{name:"京酱肉丝",id:"44417",price:32,priceText:"32.00",charge:0,chargeText:"0.00",count:0,index:25},{name:"什锦小炒美人骨",id:"11179",price:42,priceText:"42.00",charge:0,chargeText:"0.00",count:0,index:26},{name:"什锦干锅蘑",id:"11189",price:32,priceText:"32.00",charge:0,chargeText:"0.00",count:0,index:27},{name:"什锦牛丸",id:"11159",price:48,priceText:"48.00",charge:0,chargeText:"0.00",count:0,index:28},{name:"兰花小炒",id:"44428",price:28,priceText:"28.00",charge:0,chargeText:"0.00",count:0,index:29},{name:"兰花牛肉",id:"11138",price:38,priceText:"38.00",charge:0,chargeText:"0.00962",count:0,index:30},{name:"养生骨髓羹",id:"40042",price:36,priceText:"36.00",charge:0,chargeText:"0.00",count:0,index:31},{name:"农家一锅出",id:"40008",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:32},{name:"农家大炖",id:"44420",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:33},{name:"农家杀猪菜",id:"40050",price:38,priceText:"38.00",charge:0,chargeText:"0.00",count:0,index:34},{name:"农家韭菜土鸡蛋",id:"11180",price:26,priceText:"26.00",charge:0,chargeText:"0.00",count:0,index:35},{name:"冰樽纯生",id:"20021",price:12,priceText:"12.00",charge:0,chargeText:"0.00",count:0,index:36},{name:"冰纯",id:"20020",price:8,priceText:"8.00",charge:0,chargeText:"0.00",count:0,index:37},{name:"刺身拼盘",id:"50030",price:228,priceText:"228.00",charge:0,chargeText:"0.00",count:0,index:38},{name:"加工费1",id:"11143",price:10,priceText:"10.00",charge:0,chargeText:"0.00",count:0,index:39},{name:"加工费2",id:"11142",price:15,priceText:"15.00",charge:0,chargeText:"0.00",count:0,index:40},{name:"加工费3",id:"11141",price:20,priceText:"20.00",charge:0,chargeText:"0.00",count:0,index:41},{name:"加肉",id:"11140",price:10,priceText:"10.00",charge:0,chargeText:"0.00",count:0,index:42},{name:"加菜",id:"00009",price:5,priceText:"5.00",charge:0,chargeText:"0.00",count:0,index:43},{name:"加菜1",id:"00029",price:1,priceText:"1.00",charge:0,chargeText:"0.00",count:0,index:44},{name:"压锅两样",id:"40013",price:46,priceText:"46.00",charge:0,chargeText:"0.00",count:0,index:45},{name:"压锅排骨",id:"40047",price:58,priceText:"58.00",charge:0,chargeText:"0.00",count:0,index:46},{name:"压锅鸡手",id:"40051",price:48,priceText:"48.00",charge:0,chargeText:"0.00",count:0,index:47},{name:"口子窖",id:"60003",price:168,priceText:"168.00",charge:0,chargeText:"0.00",count:0,index:48},{name:"口水鸡",id:"11135",price:48,priceText:"48.00",charge:0,chargeText:"0.00",count:0,index:49}]};g.helper("format",function(a){return o(a,2)}),d.loadDateValue(),i({hotelId:v,startTime:w,unit:parseInt(sessionStorage.getItem("cur_unit"),10)||1,type:"star"}),k(),B?f(".cancel-tip").hide():f(".cancel-tip").show();var D=document.querySelector(".top-nav").querySelector(".go-directory");D.href=D.href+"?hotelId="+v;var E,F=document.querySelector(".go-back");F.addEventListener("touchstart",function(){window.location.href="index.html?hotelId="+v},!1),f(".px-confirm").on("tap",".confirm-button",function(){f(this).hasClass("confirm-submit")?l(E):(f(".px-confirm").hide(),f(".mask").hide())}),f(".mask").on("tap",function(){f(".px-confirm").hide(),f(this).hide()}),f(".close-btn").on("tap",function(){f(".cancel-tip").hide(),localStorage.setItem("cancelTip",1)}),f(".star-topdishes-ul").on("tap",".start-top-item",function(){f(".confirm-content").text('是否取消 "'+f(this).find(".dish-name").text()+'" 排名?'),f(".px-confirm").show(),f(".mask").show(),E=f(this).attr("dishId")}),f(".remark-tip").on("tap",function(){window.location.href="starMenuComment.html"}),f(".dishes-tab").on("tap",".dishes-tab-item",function(a){f(".dishes-tab-item").removeClass("tab-selected"),f(this).addClass("tab-selected");var b=f(this).attr("operateType");k({hotelId:v,startTime:w,unit:z,start:p[b].curNum,size:q,type:b})}),h(document.querySelector(".dishes-statis-detail"),document.getElementById("js_loadMore"),function(){k({hotelId:v,startTime:w,unit:z,start:p[f(".tab-selected").attr("operateType")].curNum,size:q,type:f(".tab-selected").attr("operateType")},!0)}),x.addEventListener("click",function(){var a=e.date(1);sessionStorage.setItem("cur_time",a),i({hotelId:v,startTime:a,unit:z,type:"star"}),k({hotelId:v,startTime:a,unit:z,start:0,size:q,type:f(".tab-selected").attr("operateType")})},!1),y.addEventListener("click",function(){var a=e.date(-1);sessionStorage.setItem("cur_time",a),i({hotelId:v,startTime:a,unit:z,type:"star"}),k({hotelId:v,startTime:a,unit:z,start:0,size:q,type:f(".tab-selected").attr("operateType")})},!1),f(document).on("date",function(a,b,c){sessionStorage.setItem("cur_unit",c),sessionStorage.setItem("cur_time",b),z=c,i({hotelId:v,startTime:b,unit:z,type:"star"}),k({hotelId:v,startTime:b,unit:z,start:0,size:q,type:f(".tab-selected").attr("operateType")})}),d.subscribeDate(function(a){var b=new Date(a);b.setHours(23,59),b=b.getTime(),sessionStorage.setItem("cur_time",b),i({hotelId:v,startTime:b,unit:z,type:"star"}),k({hotelId:v,startTime:b,unit:z,start:0,size:q,type:f(".tab-selected").attr("operateType")})})})});