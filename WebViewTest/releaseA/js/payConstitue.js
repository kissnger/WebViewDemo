require(["config"],function(){require(["libs/pjs","libs/chart","libs/utily","services/dateService","libs/dateChange","zepto","libs/artTemplate","libs/sidebar"],function(a,b,c,d,e,f,g){function h(a){k&&k.destroy();var c,d=q.payComposition,e={labels:[],datasets:[{label:"My First dataset",fillColor:"#35C8DD",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"#45c8dc",data:[]}]};if(f(".payconstitue-summary").hide(),f(".payconstitue-detail").hide(),f(".no-datas").show(),d&&d.length>0){f(".no-datas").hide(),f(".payconstitue-summary").show(),f(".payconstitue-detail").show(),j=[],c=[];for(var h=0,i=d.length;i>h;h+=1)j.push({type:d[h].type,typeTotal:d[h].total,data:d[h].detail}),e.labels.push(d[h].type),e.datasets[0].data.push(d[h].total),c.push({total:d[h].total,type:d[h].type});var n=170/i;k=new b(m).Bar(e,{barValueSpacing:n,scaleShowLabels:!0,scaleFontSize:20,scaleFontFamily:"黑体",tooltipTemplate:"<%if (label){%><%=label%>: <%}%><%= value.toFixed(2) %>"});var o='{{if payCompData.length}} {{each payCompData as obj}}<li class="paytype-item"><div class="paytype-wrap clearfix"><label class="paytype-name fl">{{obj.type}}</label><label class="paytype-money fr">￥{{obj.total | format}}</label></div></li>{{/each}}{{/if}}';g.helper("format",function(a){return l(a,2)});var p=g.compile(o);f(".paytype-summary-ul").html(p({payCompData:c})),f(".paytype-summary-ul .paytype-item").eq(0).click()}}function i(a){var b=q.staticSummary;if(b){var c=document.getElementById("js_needmoney"),d=document.getElementById("js_recivedmoney");c.innerText="￥"+l(b.summary.needTotal,2),d.innerText="￥"+l(b.summary.recieveTotal,2)}}var j,k,l=c.toFixed,m=document.getElementById("js_payconstitue_report").getContext("2d"),n=a.getPathArgument("hotelId"),o=new Date,p=parseInt(sessionStorage.getItem("cur_time"),10),q=(parseInt(sessionStorage.getItem("cur_unit"),10),p||Date.parse(o.getFullYear()+"/"+(o.getMonth()+1)+"/"+o.getDate()+" 23:59:00"),{payComposition:[{total:96,totalText:"96.00",type:"微信",detail:[{total:96,totalText:"96.00",type:"微信哈哈哈哈哈哈哈哈哈哈哈哈"}]},{total:38,totalText:"38.00",type:"挂账",detail:[{total:38,totalText:"38.00",type:"挂账支付"}]},{total:2,totalText:"2.00",type:"刷卡",detail:[{total:2,totalText:"2.00",type:"建设"}]},{total:5,totalText:"5.00",type:"红包",detail:[{total:5,totalText:"5.00",type:"红包"}]},{total:239.4,totalText:"239.40",type:"现金",detail:[{total:239.4,totalText:"239.40",type:"现金支付"}]},{total:12,totalText:"12.00",type:"会员",detail:[{total:12,totalText:"12.00",type:"会员支付"}]}],staticSummary:{summary:{needTotal:459,needTotalText:"459.00",recieveTotal:392.4,recieveTotalText:"392.40",oncreditTotal:0,oncreditTotalText:null,freeTotal:0,freeTotalText:null,backDishTotal:0,backDishTotalText:null,preferentialTotal:0,preferentialTotalText:null,serviceFee:0,serviceFeeText:null,ordernumTotal:0,customernumTotal:0,tableReuseRate:0,tableReuseRatePercent:null,avgPerPerson:0,avgPerTable:0,maxDaily:0,maxDailyText:null,avgDaily:0,avgDailyText:null},payment:null,discount:null,money:null}});d.loadDateValue(),f(".paytype-summary-ul").on("click",".paytype-item",function(a){var b,c,d,e,h='{{if dataDetail.length}}{{each dataDetail as obj}}<li class="pay-detail-item"><div class="pay-detail-wrap"><label class="paytype-detail-name w25 inline-block">{{obj.type}}</label><label class="paytype-detail-money w50 inline-block">￥{{obj.total | format}}</label><label class="paytype-detail-percent w25 inline-block">{{(obj.total/totalMoney)*100 | format}}%</label></div></li>{{/each}}{{/if}}';f(".paytype-item").removeClass("paytype-item-selected"),f(a.currentTarget).addClass("paytype-item-selected");for(var i=0,k=j.length;k>i;i+=1)if(j[i].type==f(a.currentTarget).find(".paytype-name").text()){c=j[i].data,b=j[i].typeTotal,f(".pay-detail-title").text(j[i].type+"类占比");break}g.helper("format",function(a){return l(a,2)}),d=g.compile(h),e=d({dataDetail:c,totalMoney:b}),f(".pay-detail-ul").html(e)}),h(),i();var r=document.querySelector(".top-nav").querySelector(".go-directory");r.href=r.href+"?hotelId="+n;var s=document.querySelector(".go-back");s.addEventListener("touchstart",function(){window.location.href="index.html?hotelId="+n},!1);var t=document.querySelector(".px_date_right"),u=document.querySelector(".px_date_left"),v=1;t.addEventListener("click",function(){var a=e.date(1);sessionStorage.setItem("cur_time",a),f(".pay-detail-title").text(""),f(".pay-detail-ul").html(""),h({hotelId:n,startTime:a,unit:v}),i({hotelId:n,startTime:a,unit:v,type:"simple"})},!1),u.addEventListener("click",function(){var a=e.date(-1);sessionStorage.setItem("cur_time",a),f(".pay-detail-title").text(""),f(".pay-detail-ul").html(""),h({hotelId:n,startTime:a,unit:v}),i({hotelId:n,startTime:a,unit:v,type:"simple"})},!1),f(document).on("date",function(a,b,c){v=c,sessionStorage.setItem("cur_unit",c),sessionStorage.setItem("cur_time",b),f(".pay-detail-title").text(""),f(".pay-detail-ul").html(""),h({hotelId:n,startTime:b,unit:v}),i({hotelId:n,startTime:b,unit:v,type:"simple"})}),d.subscribeDate(function(a){var b=new Date(a);b.setHours(23,59),b=b.getTime(),sessionStorage.setItem("cur_time",b),f(".pay-detail-title").text(""),f(".pay-detail-ul").html(""),h({hotelId:n,startTime:b,unit:v}),i({hotelId:n,startTime:b,unit:v,type:"simple"})})})});