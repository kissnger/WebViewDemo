require(["config"],function(){require(["libs/pjs","libs/chart","libs/utily","services/dateService","libs/dateChange","libs/sidebar"],function(a,b,c,d,e){function f(a,b){var c,e,f,g=0,h=0,i=0,j=[],k=[],l=[];if(1===b)e=24;else if(2===b)e=7;else if(3===b){var m=$(".px_date_input").val().split("-");e=d.getDaysByMonth(parseInt(m[0],10),parseInt(m[1],10))}else 4===b&&(e=12);for(c=0;e>c;c++)j.push(0),k.push(0),l.push(c+1);for(q=[],c=0,f=a.length;f>c;c+=1)p.setTime(a[c].timestamp),1===b&&q.push(p.getHours()+":00"),h=a[c].needTotal,0!=h&&0===g&&(g=c-1),j[c]=h.toFixed(2),i=a[c].recieveTotal,k[c]=i.toFixed(2);document.querySelector(".business-data").style.display="block",-1===g&&(g=0),1===b?r.labels=q.slice(g):2===b?r.labels=["周一","周二","周三","周四","周五","周六","周日"].slice(g):3===b?r.labels=l.slice(g):4===b&&(r.labels=l.slice(g)),r.datasets[0].data=j.slice(g),r.datasets[1].data=k.slice(g)}function g(a){i=Number(document.querySelector(".date_select_item").getAttribute("unit")),a&&(a.unit=i);var c=n.staticDetail;c?(f(c,i),j&&j.destroy(),j=new b(o).Line(r,{scaleShowLabels:!0,scaleFontSize:24,scaleFontFamily:"'微软雅黑','Helvetica'",scaleShowLabels:!0,bezierCurve:!1,datasetFill:!1})):(document.querySelector(".business-data").style.display="none",document.querySelector(".no-datas").style.display="block")}function h(a){var b=n.staticSummary,c="",d="",e=document.querySelector(".business-statistic"),f=document.querySelector(".statistic-ul"),g=f.querySelector(".statistic-item"),h=e.querySelector(".statistic-itemtitle"),i=f.querySelector(".menu-name"),j=f.querySelector(".numbers"),l=f.querySelector(".unit");if(b){var m=b.summary;f.style.display="block",e.style.display="block",document.querySelector(".no-datas").style.display="none",document.querySelector(".business-data").style.display="block",document.getElementById("js_avgmoney").innerText="￥"+k(m.avgDaily,2),document.getElementById("js_maxmoney").innerText="￥"+k(m.maxDaily,2),h.innerText="综合统计",i.innerText="应收合计",j.innerText=k(m.needTotal,2),d+=g.outerHTML,i.innerText="实收合计",j.innerText=k(m.recieveTotal,2),d+=g.outerHTML,i.innerText="挂账合计",j.innerText=k(m.oncreditTotal,2),d+=g.outerHTML,i.innerText="免单合计",j.innerText=k(m.freeTotal,2),d+=g.outerHTML,i.innerText="退菜合计",j.innerText=k(m.backDishTotal,2),d+=g.outerHTML,i.innerText="优惠合计",j.innerText=k(m.preferentialTotal,2),d+=g.outerHTML,i.innerText="服务费",j.innerText=k(m.serviceFee,2),d+=g.outerHTML,i.innerText="总单数",j.innerText=m.ordernumTotal,l.innerText="",d+=g.outerHTML,i.innerText="总人数",j.innerText=m.customernumTotal,l.innerText="",d+=g.outerHTML,i.innerText="翻台率",j.innerText=m.tableReuseRate+"%",l.innerText="",d+=g.outerHTML,f.innerHTML=d,c+=h.outerHTML+f.outerHTML,d="",l.innerText="￥";var o=b.payment;h.innerText="结账方式",i.innerText="现金",j.innerText=k(o.cashMoney,2),d+=g.outerHTML,i.innerText="银行卡",j.innerText=k(o.cardMoney,2),d+=g.outerHTML,i.innerText="会员卡",j.innerText=k(o.memberCardMoney,2),d+=g.outerHTML,i.innerText="优惠券",j.innerText=k(o.couponMoney,2),d+=g.outerHTML,i.innerText="团购券",j.innerText=k(o.grouponMoney,2),d+=g.outerHTML,i.innerText="红包支付",j.innerText=k(o.lotteryMoney,2),d+=g.outerHTML,i.innerText="第三方支付",j.innerText=k(o.otherPayMoney,2),d+=g.outerHTML,i.innerText="",j.innerText="",l.innerText="",d+=g.outerHTML,f.innerHTML=d,c+=h.outerHTML+f.outerHTML,d="",l.innerText="￥";var p=b.discount;h.innerText="优惠方式",i.innerText="折扣",j.innerText=k(p.discountMoney,2),d+=g.outerHTML,i.innerText="赠送",j.innerText=k(p.giftMoney,2),d+=g.outerHTML,i.innerText="系统抹零",j.innerText=k(p.sysWipeMoney,2),d+=g.outerHTML,i.innerText="手动抹零",j.innerText=k(p.manualWipeMoney,2),d+=g.outerHTML,i.innerText="团购券结余",j.innerText=k(p.overGroupon,2),d+=g.outerHTML,i.innerText="",j.innerText="",l.innerText="",d+=g.outerHTML,f.innerHTML=d,c+=h.outerHTML+f.outerHTML,d="",l.innerText="￥";var q=b.money;h.innerText="后台收款",i.innerText="会员充值",j.innerText=k(q.memberCharge,2),d+=g.outerHTML,i.innerText="会员退款",j.innerText=k(q.memberRefund,2),d+=g.outerHTML,i.innerText="挂账预收",j.innerText=k(q.advances,2),d+=g.outerHTML,i.innerText="减免金额",j.innerText=k(q.reduction,2),d+=g.outerHTML,f.innerHTML=d,c+=h.outerHTML+f.outerHTML,e.innerHTML=c}else h.innerText="无营业数据",f.style.display="none",c+=h.outerHTML+f.outerHTML,e.innerHTML=c,e.style.display="none",document.querySelector(".no-datas").style.display="block"}var i,j,k=c.toFixed,l=a.getPathArgument("hotelId"),m=(parseInt(sessionStorage.getItem("cur_unit"),10),parseInt(sessionStorage.getItem("cur_time"),10),new Date),n=(Date.parse(m.getFullYear()+"/"+(m.getMonth()+1)+"/"+m.getDate()+" 23:59:00"),{staticDetail:[{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14458752e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14458788e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14458824e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:1445886e6},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14458896e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14458932e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14458968e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14459004e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:1445904e6},{needTotal:26,needTotalText:"26.00",recieveTotal:26,recieveTotalText:"26.00",timestamp:14459076e5},{needTotal:16,needTotalText:"16.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14459112e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14459148e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14459184e5},{needTotal:38,needTotalText:"38.00",recieveTotal:2,recieveTotalText:"2.00",timestamp:1445922e6},{needTotal:30,needTotalText:"30.00",recieveTotal:30,recieveTotalText:"30.00",timestamp:14459256e5},{needTotal:73,needTotalText:"73.00",recieveTotal:63,recieveTotalText:"63.00",timestamp:14459292e5},{needTotal:142,needTotalText:"142.00",recieveTotal:137.4,recieveTotalText:"137.40",timestamp:14459328e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14459364e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:144594e7},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14459436e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14459472e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14459508e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:14459544e5},{needTotal:0,needTotalText:"0.00",recieveTotal:0,recieveTotalText:"0.00",timestamp:1445958e6}],staticSummary:{summary:{needTotal:325,needTotalText:"325.00",recieveTotal:258.4,recieveTotalText:"258.40",oncreditTotal:38,oncreditTotalText:"38.00",freeTotal:8,freeTotalText:"8.00",backDishTotal:43,backDishTotalText:"43.00",preferentialTotal:58.6,preferentialTotalText:"58.60",serviceFee:10,serviceFeeText:"10.00",ordernumTotal:11,customernumTotal:12,tableReuseRate:0,tableReuseRatePercent:"0%",avgPerPerson:21.53,avgPerTable:23.49,maxDaily:50100,maxDailyText:"50,100.00",avgDaily:4406.53,avgDailyText:"4,406.53"},payment:{cashMoney:108.4,cashMoneyText:"108.40",cardMoney:2,cardMoneyText:"2.00",memberCardMoney:12,memberCardMoneyText:"12.00",couponMoney:0,couponMoneyText:"0.00",grouponMoney:0,grouponMoneyText:"0.00",otherPayMoney:0,otherPayMoneyText:"0.00",lotteryMoney:2,lotteryMoneyText:"2.00"},discount:{discountMoney:4.6,discountMoneyText:"4.60",giftMoney:34,giftMoneyText:"34.00",sysWipeMoney:0,sysWipeMoneyText:"0.00",manualWipeMoney:20,manualWipeMoneyText:"20.00",overGroupon:0,overGrouponText:"0.00"},money:{memberCharge:50,memberChargeText:"50.00",memberRefund:0,memberRefundText:"0.00",advances:0,advancesText:"0.00",reduction:0,reductionText:"0.00"}}});d.loadDateValue();var o=document.getElementById("js_cure_report").getContext("2d"),p=new Date,q=["0:00","1:00","2:00","3:00","4:00","5:00","6:00","7:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],r={labels:[],datasets:[{fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",data:[]},{fillColor:"rgba(69, 200, 220, 0.2)",strokeColor:"#45c8dc",pointColor:"#45c8dc",pointStrokeColor:"#45c8dc",data:[]}]};g(),h();var s=document.querySelector(".top-nav").querySelector(".go-directory");s.href=s.href+"?hotelId="+l;var t=document.querySelector(".go-back");t.addEventListener("touchstart",function(){window.location.href="index.html?hotelId="+l},!1);var u=document.querySelector(".px_date_right"),v=document.querySelector(".px_date_left");u.addEventListener("click",function(){var a=e.date(1);sessionStorage.setItem("cur_time",a),g({hotelId:l,startTime:a}),h({hotelId:l,startTime:a})},!1),v.addEventListener("click",function(){var a=e.date(-1);sessionStorage.setItem("cur_time",a),g({hotelId:l,startTime:a}),h({hotelId:l,startTime:a})},!1),$(document).on("date",function(a,b,c){sessionStorage.setItem("cur_unit",c),sessionStorage.setItem("cur_time",b),g({hotelId:l,startTime:b}),h({hotelId:l,startTime:b})}),d.subscribeDate(function(a){var b=new Date(a);b.setHours(23),b=b.getTime(),sessionStorage.setItem("cur_time",b),g({hotelId:l,startTime:b}),h({hotelId:l,startTime:b})})})});